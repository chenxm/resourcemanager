var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t;return{next:verb(0),throw:verb(1),return:verb(2)};function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=y[op[0]&2?"return":op[0]?"throw":"next"])&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[0,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};var __decorate=this&&this.__decorate||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;return c>3&&r&&Object.defineProperty(target,key,r),r};"use strict";function error(s){console.trace(s);throw new Error(s)}var codeLenCodeMap=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);var lengthDecode=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]);var distDecode=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]);var fixedLitCodeTab=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9];var fixedDistCodeTab=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];function inflate(bytes){var bytesPos=0;var codeSize=0;var codeBuf=0;function getBits(bits){var b;while(codeSize<bits){b=bytes[bytesPos++]|0;codeBuf|=b<<codeSize;codeSize+=8}b=codeBuf&(1<<bits)-1;codeBuf>>=bits;codeSize-=bits;return b}function getCode(table){var codes=table[0];var maxLen=table[1];while(codeSize<maxLen){var b=bytes[bytesPos++]|0;codeBuf|=b<<codeSize;codeSize+=8}var code=codes[codeBuf&(1<<maxLen)-1];var codeLen=code>>16;var codeVal=code&65535;if(codeSize==0||codeSize<codeLen||codeLen==0)error("Bad encoding in flate stream");codeBuf>>=codeLen;codeSize-=codeLen;return codeVal}function generateHuffmanTable(lengths){var n=lengths.length;var maxLen=0;for(var i=0;i<n;++i){if(lengths[i]>maxLen)maxLen=lengths[i]}var size=1<<maxLen;var codes=new Uint32Array(size);for(var len=1,code=0,skip=2;len<=maxLen;++len,code<<=1,skip<<=1){for(var val=0;val<n;++val){if(lengths[val]==len){var code2=0;var t=code;for(var i=0;i<len;++i){code2=code2<<1|t&1;t>>=1}for(var i=code2;i<size;i+=skip)codes[i]=len<<16|val;++code}}}return[codes,maxLen]}var buffer;var bufferLength=0;function ensureBuffer(requested){var current=buffer?buffer.byteLength:0;if(requested<current)return;var size=512;while(size<requested)size<<=1;var buffer2=new Uint8Array(size);for(var i=0;i<current;++i)buffer2[i]=buffer[i];buffer=buffer2}function readBlock(){var eof=false;var hdr=getBits(3);if(hdr&1)eof=true;hdr>>=1;if(hdr==0){var b;if(typeof(b=bytes[bytesPos++])=="undefined")error("Bad block header in flate stream");var blockLen=b;if(typeof(b=bytes[bytesPos++])=="undefined")error("Bad block header in flate stream");blockLen|=b<<8;if(typeof(b=bytes[bytesPos++])=="undefined")error("Bad block header in flate stream");var check=b;if(typeof(b=bytes[bytesPos++])=="undefined")error("Bad block header in flate stream");check|=b<<8;if(check!=(~blockLen&65535))error("Bad uncompressed block length in flate stream");codeBuf=0;codeSize=0;ensureBuffer(bufferLength+blockLen);var end=bufferLength+blockLen;for(var n=bufferLength;n<end;++n){if(typeof(b=bytes[bytesPos++])=="undefined"){eof=true;break}buffer[n]=b}bufferLength=end;return eof}var litCodeTable;var distCodeTable;if(hdr==1){litCodeTable=fixedLitCodeTab;distCodeTable=fixedDistCodeTab}else if(hdr==2){var numLitCodes=getBits(5)+257;var numDistCodes=getBits(5)+1;var numCodeLenCodes=getBits(4)+4;var codeLenCodeLengths=new Uint8Array(codeLenCodeMap.length);for(var i=0;i<numCodeLenCodes;++i)codeLenCodeLengths[codeLenCodeMap[i]]=getBits(3);var codeLenCodeTab=generateHuffmanTable(codeLenCodeLengths);var len=0;var i=0;var codes=numLitCodes+numDistCodes;var codeLengths=new Uint8Array(codes);while(i<codes){var code=getCode(codeLenCodeTab);if(code==16){var bitsLength=2,bitsOffset=3,what=len}else if(code==17){var bitsLength=3,bitsOffset=3,what=len=0}else if(code==18){var bitsLength=7,bitsOffset=11,what=len=0}else{codeLengths[i++]=len=code;continue}var repeatLength=getBits(bitsLength)+bitsOffset;while(repeatLength-- >0)codeLengths[i++]=what}litCodeTable=generateHuffmanTable(codeLengths.subarray(0,numLitCodes));distCodeTable=generateHuffmanTable(codeLengths.subarray(numLitCodes,codes))}else{error("Unknown block type in flate stream")}var limit=buffer?buffer.length:0;var pos=bufferLength;while(true){var code1=getCode(litCodeTable);if(code1<256){if(pos+1>=limit){ensureBuffer(pos+1);limit=buffer.length}buffer[pos++]=code1;continue}if(code1==256){bufferLength=pos;return eof}code1-=257;code1=lengthDecode[code1];var code2=code1>>16;if(code2>0)code2=getBits(code2);var len=(code1&65535)+code2;code1=getCode(distCodeTable);code1=distDecode[code1];code2=code1>>16;if(code2>0)code2=getBits(code2);var dist=(code1&65535)+code2;if(pos+len>=limit){ensureBuffer(pos+len);limit=buffer.length}for(var k=0;k<len;++k,++pos)buffer[pos]=buffer[pos-dist]}}while(!readBlock());return new Uint8Array(buffer.buffer,0,bufferLength)}var ZipFile=function(){function ZipFile(buffer){var bytes=new Uint8Array(buffer);var view=new DataView(buffer);if(view.getInt32(0,true)!=67324752)return;var pos=bytes.length-22;while(true){if(pos<0)return;if(bytes[pos]!=80){--pos;continue}if(view.getInt32(pos,true)==101010256)break;pos-=4}var directory=Object.create(null);var entries=view.getInt16(pos+8,true);var pos=view.getInt32(pos+16,true);while(entries--){if(view.getInt32(pos,true)!=33639248)return;var compression_method=view.getInt16(pos+10,true);var compressed_len=view.getInt32(pos+20,true);var uncompressed_len=view.getInt32(pos+24,true);var filename_len=view.getInt16(pos+28,true);var extra_len=view.getInt16(pos+30,true);var comment_len=view.getInt16(pos+32,true);var local_header_offset=view.getInt32(pos+42,true);pos+=46;var filename="";for(var n=0;n<filename_len;++n)filename+=String.fromCharCode(bytes[pos++]);var local_extra_len=view.getInt16(local_header_offset+28,true);var data_offset=local_header_offset+30+filename_len+local_extra_len;directory[filename]={compression_method:compression_method,compressed_data:new Uint8Array(buffer,data_offset,compressed_len)};pos+=extra_len+comment_len}this.directory=directory}ZipFile.prototype.read=function(filename){if(!this.directory)return null;var entry=this.directory[filename];if(!entry)return null;var data=entry.compressed_data;switch(entry.compression_method){case 0:return data;case 8:return inflate(data)}return null};return ZipFile}();var RES;(function(RES){var ResourceNodeType;(function(ResourceNodeType){ResourceNodeType[ResourceNodeType["FILE"]=0]="FILE";ResourceNodeType[ResourceNodeType["DICTIONARY"]=1]="DICTIONARY"})(ResourceNodeType||(ResourceNodeType={}));function getResourceInfo(path){var result=FileSystem.getFile(path);if(!result){path=RES.resourceNameSelector(path);result=FileSystem.getFile(path)}return result}RES.getResourceInfo=getResourceInfo;var FileSystem;(function(FileSystem){FileSystem.data={};function addFile(filename,type){if(!type)type="";filename=normalize(filename);var basefilename=basename(filename);var folder=dirname(filename);if(!exists(folder)){mkdir(folder)}var d=reslove(folder);d[basefilename]={url:filename,type:type}}FileSystem.addFile=addFile;function getFile(filename){var result=reslove(filename);if(result){result.name=filename}return result}FileSystem.getFile=getFile;function basename(filename){return filename.substr(filename.lastIndexOf("/")+1)}function normalize(filename){return filename.split("/").filter(function(d){return!!d}).join("/")}function dirname(path){return path.substr(0,path.lastIndexOf("/"))}function reslove(dirpath){if(dirpath==""){return FileSystem.data}dirpath=normalize(dirpath);var list=dirpath.split("/");var current=FileSystem.data;for(var _i=0,list_1=list;_i<list_1.length;_i++){var f=list_1[_i];if(current){current=current[f]}else{return current}}return current}function mkdir(dirpath){dirpath=normalize(dirpath);var list=dirpath.split("/");var current=FileSystem.data;for(var _i=0,list_2=list;_i<list_2.length;_i++){var f=list_2[_i];if(!current[f]){current[f]={}}current=current[f]}}FileSystem.mkdir=mkdir;function exists(dirpath){if(dirpath=="")return true;dirpath=normalize(dirpath);var list=dirpath.split("/");var current=FileSystem.data;for(var _i=0,list_3=list;_i<list_3.length;_i++){var f=list_3[_i];if(!current[f]){return false}current=current[f]}return true}FileSystem.exists=exists})(FileSystem=RES.FileSystem||(RES.FileSystem={}))})(RES||(RES={}));var RES;(function(RES){RES.resourceNameSelector=function(p){return p};var configItem;function setConfigURL(url){configItem={type:"commonjs",resourceRoot:RES.resourceRoot,url:url,name:url}}RES.setConfigURL=setConfigURL;RES.resourceRoot="";var ResourceConfig=function(){function ResourceConfig(){}ResourceConfig.prototype.init=function(){var _this=this;return RES.queue.loadResource(configItem).then(function(data){return _this.parseConfig(data)}).catch(function(e){if(!e.__resource_manager_error__){console.error(e.stack);e=new RES.ResourceManagerError(1002)}return Promise.reject(e)})};ResourceConfig.prototype.getGroupByName=function(name,shouldNotBeNull){var group=this.config.groups[name];var result=[];if(!group){if(shouldNotBeNull){throw new RES.ResourceManagerError(2005,name)}return null}for(var _i=0,group_1=group;_i<group_1.length;_i++){var paramKey=group_1[_i];var _a=RES.config.getResourceWithSubkey(paramKey,true),key=_a.key,subkey=_a.subkey;var r=RES.config.getResource(key,true);if(result.indexOf(r)==-1){result.push(r)}}return result};ResourceConfig.prototype.__temp__get__type__via__url=function(url_or_alias){var url=this.config.alias[url_or_alias];if(!url){url=url_or_alias}if(RES.resourceTypeSelector){var type=RES.resourceTypeSelector(url);if(!type){throw new RES.ResourceManagerError(2004,url)}return type}else{console.warn("RES.mapConfig 并未设置 typeSelector");return"unknown"}};ResourceConfig.prototype.getResourceWithSubkey=function(key,shouldNotBeNull){key=this.getKeyByAlias(key);var index=key.indexOf("#");var subkey="";if(index>=0){subkey=key.substr(index+1);key=key.substr(0,index)}var r=this.getResource(key);if(!r){if(shouldNotBeNull){var msg=subkey?key+"#"+subkey:key;throw new RES.ResourceManagerError(2006,msg)}else{return null}}else{return{r:r,key:key,subkey:subkey}}};ResourceConfig.prototype.getKeyByAlias=function(aliasName){if(this.config.alias[aliasName]){return this.config.alias[aliasName]}else{return aliasName}};ResourceConfig.prototype.getResource=function(path_or_alias,shouldNotBeNull){var path=this.config.alias[path_or_alias];if(!path){path=path_or_alias}var file=RES.getResourceInfo(path);var r=file;if(!r){if(shouldNotBeNull){throw new RES.ResourceManagerError(2006,path_or_alias)}return null}r;return r};ResourceConfig.prototype.getGroup=function(name){return this.getGroupByName(name)};ResourceConfig.prototype.createGroup=function(name,keys,override){if(override===void 0){override=false}if(!override&&this.config.groups[name]||!keys||keys.length==0){return false}var group=[];for(var _i=0,keys_1=keys;_i<keys_1.length;_i++){var key=keys_1[_i];if(this.config.groups[key]){var groupInfo=this.config.groups[key];group=group.concat(groupInfo)}else{group=group.concat(key)}}this.config.groups[name]=group;return true};ResourceConfig.prototype.parseConfig=function(data){RES.resourceRoot=data.resourceRoot+"/";this.config=data;RES.resourceTypeSelector=data.typeSelector;RES.resourceMergerSelector=data.mergeSelector;RES.FileSystem.data=data.resources};ResourceConfig.prototype.addSubkey=function(subkey,name){this.addAlias(subkey,name+"#"+subkey)};ResourceConfig.prototype.addAlias=function(alias,key){if(this.config.alias[key]){key=this.config.alias[key]}this.config.alias[alias]=key};ResourceConfig.prototype.getType=function(key){return this.getResource(key,true).type};ResourceConfig.prototype.addResourceData=function(data){if(!data.type){data.type=this.__temp__get__type__via__url(data.url)}RES.FileSystem.addFile(data.url,data.type);if(data.name){this.config.alias[data.name]=data.url}};ResourceConfig.prototype.destory=function(){RES.systemPid++;this.config={groups:{},alias:{},resources:{},typeSelector:function(p){return p},resourceRoot:"resources",mergeSelector:null};RES.FileSystem.data={}};return ResourceConfig}();RES.ResourceConfig=ResourceConfig})(RES||(RES={}));var RES;(function(RES){var ResourceLoader=function(){function ResourceLoader(){}ResourceLoader.prototype.load=function(list,reporter){var _this=this;var current=0;var total=1;var mapper=function(r){return _this.loadResource(r).then(function(response){RES.host.save(r,response);current++;if(reporter&&reporter.onProgress){reporter.onProgress(current,total)}return response})};total=list.length;return Promise.all(list.map(mapper))};ResourceLoader.prototype.loadResource=function(r,p){if(!p){p=RES.processor.isSupport(r)}if(!p){throw new RES.ResourceManagerError(2001,r.name,r.type)}RES.host.state[r.name]=1;var promise=p.onLoadStart(RES.host,r);r.promise=promise;return promise};ResourceLoader.prototype.unloadResource=function(r){var data=RES.host.get(r);if(!data){console.warn("尝试释放不存在的资源:",r.name);return Promise.resolve()}var p=RES.processor.isSupport(r);if(p){RES.host.state[r.name]=3;return p.onRemoveStart(RES.host,r).then(function(result){RES.host.remove(r);return result})}else{return Promise.resolve()}};return ResourceLoader}();RES.ResourceLoader=ResourceLoader})(RES||(RES={}));var RES;(function(RES){var __tempCache={};RES.systemPid=0;RES.checkCancelation=function(target,propertyKey,descriptor){var method=descriptor.value;descriptor.value=function(){var arg=[];for(var _i=0;_i<arguments.length;_i++){arg[_i]=arguments[_i]}var currentPid=RES.systemPid;var result=method.apply(this,arg);return result.then(function(value){if(RES.systemPid!=currentPid){throw new ResourceManagerError(1005,arg[0])}else{return value}})}};function profile(){console.log(RES.FileSystem.data);console.log(__tempCache);var totalImageSize=0;for(var key in __tempCache){var img=__tempCache[key];if(img instanceof egret.Texture){totalImageSize+=img._bitmapWidth*img._bitmapHeight*4}}console.log("gpu size : "+(totalImageSize/1024).toFixed(3)+"kb")}RES.profile=profile;RES.host={state:{},get resourceConfig(){return RES.config},load:function(r,processor){return RES.queue.loadResource(r,processor)},unload:function(r){return RES.queue.unloadResource(r)},save:function(resource,data){RES.host.state[resource.name]=2;__tempCache[resource.url]=data},get:function(resource){return __tempCache[resource.url]},remove:function(resource){RES.host.state[resource.name]=0;delete __tempCache[resource.url]}};RES.config=new RES.ResourceConfig;RES.queue=new RES.ResourceLoader;var ResourceManagerError=function(_super){__extends(ResourceManagerError,_super);function ResourceManagerError(code,replacer,replacer2){var _this=_super.call(this)||this;_this.__resource_manager_error__=true;_this.name=code.toString();_this.message=ResourceManagerError.errorMessage[code].replace("{0}",replacer).replace("{1}",replacer2);return _this}return ResourceManagerError}(Error);ResourceManagerError.errorMessage={1001:"文件加载失败:{0}",1002:"ResourceManager 初始化失败：配置文件加载失败",1005:"ResourceManager 已被销毁，文件加载失败:{0}",2001:"{0}解析失败,不支持指定解析类型:'{1}'，请编写自定义 Processor ，更多内容请参见 https://github.com/egret-labs/resourcemanager/blob/master/docs/README.md#processor",2002:"Analyzer 相关API 在 ResourceManager 中不再支持，请编写自定义 Processor ，更多内容请参见 https://github.com/egret-labs/resourcemanager/blob/master/docs/README.md#processor",2003:"{0}解析失败,错误原因:{1}",2004:"无法找到文件类型:{0}",2005:"资源配置文件中无法找到特定的资源组:{0}",2006:"资源配置文件中无法找到特定的资源:{0}"};RES.ResourceManagerError=ResourceManagerError})(RES||(RES={}));var RES;(function(RES){var processor;(function(processor_1){function isSupport(resource){return _map[resource.type]}processor_1.isSupport=isSupport;function map(type,processor){_map[type]=processor}processor_1.map=map;function promisify(loader,resource){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){return[2,new Promise(function(reslove,reject){var onSuccess=function(){var texture=loader["data"]?loader["data"]:loader["response"];reslove(texture)};var onError=function(){var e=new RES.ResourceManagerError(1001,resource.url);reject(e)};loader.addEventListener(egret.Event.COMPLETE,onSuccess,_this);loader.addEventListener(egret.IOErrorEvent.IO_ERROR,onError,_this)})]})})}function getURL(resource){var prefix=resource.extra?"":RES.resourceRoot;var url=prefix+resource.url;if(RES["getRealURL"]){return RES["getRealURL"](url)}else{return url}}function getRelativePath(url,file){url=url.split("\\").join("/");var params=url.match(/#.*|\?.*/);var paramUrl="";if(params){paramUrl=params[0]}var index=url.lastIndexOf("/");if(index!=-1){url=url.substring(0,index+1)+file}else{url=file}return url+paramUrl}processor_1.getRelativePath=getRelativePath;processor_1.ImageProcessor={onLoadStart:function(host,resource){return __awaiter(this,void 0,void 0,function(){var loader,bitmapData,texture;return __generator(this,function(_a){switch(_a.label){case 0:loader=new egret.ImageLoader;loader.load(getURL(resource));return[4,promisify(loader,resource)];case 1:bitmapData=_a.sent();texture=new egret.Texture;texture._setBitmapData(bitmapData);return[2,texture]}})})},onRemoveStart:function(host,resource){var texture=host.get(resource);texture.dispose();return Promise.resolve()}};processor_1.BinaryProcessor={onLoadStart:function(host,resource){return __awaiter(this,void 0,void 0,function(){var request,arraybuffer;return __generator(this,function(_a){switch(_a.label){case 0:request=new egret.HttpRequest;request.responseType=egret.HttpResponseType.ARRAY_BUFFER;request.open(getURL(resource),"get");request.send();return[4,promisify(request,resource)];case 1:arraybuffer=_a.sent();return[2,arraybuffer]}})})},onRemoveStart:function(host,resource){return Promise.resolve()}};processor_1.TextProcessor={onLoadStart:function(host,resource){return __awaiter(this,void 0,void 0,function(){var request,text;return __generator(this,function(_a){switch(_a.label){case 0:request=new egret.HttpRequest;request.responseType=egret.HttpResponseType.TEXT;request.open(getURL(resource),"get");request.send();return[4,promisify(request,resource)];case 1:text=_a.sent();return[2,text]}})})},onRemoveStart:function(host,resource){return Promise.resolve()}};processor_1.JsonProcessor={onLoadStart:function(host,resource){return __awaiter(this,void 0,void 0,function(){var text,data;return __generator(this,function(_a){switch(_a.label){case 0:return[4,host.load(resource,processor_1.TextProcessor)];case 1:text=_a.sent();data=JSON.parse(text);return[2,data]}})})},onRemoveStart:function(host,request){return Promise.resolve()}};processor_1.XMLProcessor={onLoadStart:function(host,resource){return __awaiter(this,void 0,void 0,function(){var text,data;return __generator(this,function(_a){switch(_a.label){case 0:return[4,host.load(resource,processor_1.TextProcessor)];case 1:text=_a.sent();data=egret.XML.parse(text);return[2,data]}})})},onRemoveStart:function(host,resource){return Promise.resolve()}};processor_1.CommonJSProcessor={onLoadStart:function(host,resource){return __awaiter(this,void 0,void 0,function(){var text,f,require,exports;return __generator(this,function(_a){switch(_a.label){case 0:return[4,host.load(resource,processor_1.TextProcessor)];case 1:text=_a.sent();f=new Function("require","exports",text);require=function(){};exports={};try{f(require,exports)}catch(e){throw new RES.ResourceManagerError(2003,resource.name,e.message)}return[2,exports]}})})},onRemoveStart:function(host,resource){return Promise.resolve()}};processor_1.SheetProcessor={onLoadStart:function(host,resource){return __awaiter(this,void 0,void 0,function(){var data,imagePath,r,texture,frames,spriteSheet,subkey,config,texture;return __generator(this,function(_a){switch(_a.label){case 0:return[4,host.load(resource,processor_1.JsonProcessor)];case 1:data=_a.sent();imagePath=getRelativePath(resource.name,data.file);r=host.resourceConfig.getResource(imagePath);if(!r){throw new RES.ResourceManagerError(1001,imagePath)}return[4,host.load(r)];case 2:texture=_a.sent();frames=data.frames;spriteSheet=new egret.SpriteSheet(texture);for(subkey in frames){config=frames[subkey];texture=spriteSheet.createTexture(subkey,config.x,config.y,config.w,config.h,config.offX,config.offY,config.sourceW,config.sourceH)}return[2,spriteSheet]}})})},getData:function(host,resource,key,subkey){var data=host.get(resource);if(data){return data.getTexture(subkey)}else{console.error("missing resource : "+key+"#"+subkey);return null}},onRemoveStart:function(host,resource){return Promise.resolve()}};processor_1.FontProcessor={onLoadStart:function(host,resource){return __awaiter(this,void 0,void 0,function(){var getTexturePath,data,imageUrl,config,r,texture,font;return __generator(this,function(_a){switch(_a.label){case 0:getTexturePath=function(url,fntText){var file="";var lines=fntText.split("\n");var pngLine=lines[2];var index=pngLine.indexOf('file="');if(index!=-1){pngLine=pngLine.substring(index+6);index=pngLine.indexOf('"');file=pngLine.substring(0,index)}url=url.split("\\").join("/");var index=url.lastIndexOf("/");if(index!=-1){url=url.substring(0,index+1)+file}else{url=file}return url};return[4,host.load(resource,processor_1.TextProcessor)];case 1:data=_a.sent();imageUrl="";try{config=JSON.parse(data);imageUrl=resource.name.replace("fnt","png")}catch(e){config=data;imageUrl=resource.name.replace("fnt","png")}r=host.resourceConfig.getResource(imageUrl);if(!r)return[3,3];return[4,host.load(r)];case 2:texture=_a.sent();font=new egret.BitmapFont(texture,config);return[2,font];case 3:return[2,null]}})})},onRemoveStart:function(host,resource){return Promise.resolve()}};processor_1.SoundProcessor={onLoadStart:function(host,resource){return __awaiter(this,void 0,void 0,function(){var sound;return __generator(this,function(_a){switch(_a.label){case 0:sound=new egret.Sound;sound.load(getURL(resource));return[4,promisify(sound,resource)];case 1:_a.sent();return[2,sound]}})})},onRemoveStart:function(host,resource){return Promise.resolve()}};processor_1.MovieClipProcessor={onLoadStart:function(host,resource){return __awaiter(this,void 0,void 0,function(){var mcData,jsonPath,imagePath,r,mcTexture,mcDataFactory;return __generator(this,function(_a){switch(_a.label){case 0:return[4,host.load(resource,processor_1.JsonProcessor)];case 1:mcData=_a.sent();jsonPath=resource.name;imagePath=jsonPath.substring(0,jsonPath.lastIndexOf("."))+".png";r=host.resourceConfig.getResource(imagePath);if(!r){throw new RES.ResourceManagerError(1001,imagePath)}return[4,host.load(r)];case 2:mcTexture=_a.sent();mcDataFactory=new egret.MovieClipDataFactory(mcData,mcTexture);return[2,mcDataFactory]}})})},onRemoveStart:function(host,resource){return Promise.resolve()}};processor_1.MergeJSONProcessor={onLoadStart:function(host,resource){return __awaiter(this,void 0,void 0,function(){var data,key;return __generator(this,function(_a){switch(_a.label){case 0:return[4,host.load(resource,processor_1.JsonProcessor)];case 1:data=_a.sent();for(key in data){RES.config.addSubkey(key,resource.name)}return[2,data]}})})},getData:function(host,resource,key,subkey){var data=host.get(resource);if(data){return data[subkey]}else{console.error("missing resource :"+resource.name);return null}},onRemoveStart:function(host,resource){return Promise.resolve()}};processor_1.ResourceConfigProcessor={onLoadStart:function(host,resource){return __awaiter(this,void 0,void 0,function(){var data,resources,loop,isFile;return __generator(this,function(_a){switch(_a.label){case 0:return[4,host.load(resource,processor_1.JsonProcessor)];case 1:data=_a.sent();resources=data.resources;loop=function(r,prefix,walk){for(var key in r){var p=prefix?prefix+"/"+key:key;var f=r[key];if(isFile(f)){if(typeof f==="string"){f={url:f,name:p};r[key]=f}else{f["name"]=p}walk(f)}else{loop(f,p,walk)}}};isFile=function(r){return typeof r==="string"||r.url!=null};loop(resources,"",function(value){if(!value.type){value.type=RES.resourceTypeSelector(value.url)}});return[2,data]}})})},onRemoveStart:function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2]})})}};var PVRParser=function(){function PVRParser(){}PVRParser.parse=function(arrayBuffer,callback,errorCallback){var headerIntLength=13;var header=new Uint32Array(arrayBuffer,0,headerIntLength);var pvrDatas={buffer:arrayBuffer,header:header};if(header[0]===55727696){PVRParser._parseV3(pvrDatas,callback,errorCallback)}else if(header[11]===559044176){PVRParser._parseV2(pvrDatas,callback,errorCallback)}else{errorCallback(pvrDatas,"pvr parse error!")}};PVRParser._parseV2=function(pvrDatas,callback,errorCallback){var header=pvrDatas.header;var headerLength=header[0],height=header[1],width=header[2],numMipmaps=header[3],flags=header[4],dataLength=header[5],bpp=header[6],bitmaskRed=header[7],bitmaskGreen=header[8],bitmaskBlue=header[9],bitmaskAlpha=header[10],pvrTag=header[11],numSurfs=header[12];var TYPE_MASK=255;var PVRTC_2=24,PVRTC_4=25;var formatFlags=flags&TYPE_MASK;var bpp,format;var _hasAlpha=bitmaskAlpha>0;if(formatFlags===PVRTC_4){format=_hasAlpha?PVRParser.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:PVRParser.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;bpp=4}else if(formatFlags===PVRTC_2){format=_hasAlpha?PVRParser.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:PVRParser.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;bpp=2}else{errorCallback(pvrDatas,"pvr v2 parse error");console.log("unknow format flags::"+formatFlags)}var dataOffset=headerLength;pvrDatas.pvrtcData=new Uint8Array(pvrDatas.buffer,dataOffset);pvrDatas.bpp=bpp;pvrDatas.format=format;pvrDatas.width=width;pvrDatas.height=height;pvrDatas.surfacesCount=numSurfs;pvrDatas.mipmapsCount=numMipmaps+1;pvrDatas.isCubemap=pvrDatas.surfacesCount===6;callback(pvrDatas)};PVRParser._parseV3=function(pvrDatas,callback,errorCallback){var header=pvrDatas.header;var bpp,format;var pixelFormat=header[2];switch(pixelFormat){case 0:bpp=2;format=PVRParser.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;break;case 1:bpp=2;format=PVRParser.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;break;case 2:bpp=4;format=PVRParser.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;break;case 3:bpp=4;format=PVRParser.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;break;default:errorCallback(pvrDatas,"pvr v3 parse error");console.log("unknow pixel format::"+pixelFormat)}var dataOffset=52+header[12];pvrDatas.pvrtcData=new Uint8Array(pvrDatas.buffer,dataOffset);pvrDatas.bpp=bpp;pvrDatas.format=format;pvrDatas.width=header[7];pvrDatas.height=header[6];pvrDatas.surfacesCount=header[10];pvrDatas.mipmapsCount=header[11];pvrDatas.isCubemap=pvrDatas.surfacesCount===6;callback(pvrDatas)};return PVRParser}();PVRParser.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840;PVRParser.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841;PVRParser.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842;PVRParser.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843;if(typeof egret!="undefined"&&egret&&egret["web"]&&egret["web"].WebGLRenderContext){function textureLevelSize(format,width,height){switch(format){case PVRParser.COMPRESSED_RGB_PVRTC_4BPPV1_IMG:case PVRParser.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:return Math.floor((Math.max(width,8)*Math.max(height,8)*4+7)/8);case PVRParser.COMPRESSED_RGB_PVRTC_2BPPV1_IMG:case PVRParser.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:return Math.floor((Math.max(width,16)*Math.max(height,8)*2+7)/8);default:return 0}}egret["web"].WebGLRenderContext.prototype.createTextureFromCompressedData=function(data,width,height,levels,internalFormat){var gl=this.context;if(!this.pvrtcExt){this.pvrtcExt=gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc")}var texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,texture);var offset=0;for(var i=0;i<levels;++i){var levelSize=textureLevelSize(internalFormat,width,height);var dxtLevel=new Uint8Array(data.buffer,data.byteOffset+offset,levelSize);gl.compressedTexImage2D(gl.TEXTURE_2D,i,internalFormat,width,height,0,dxtLevel);width=width>>1;if(width<1)width=1;height=height>>1;if(height<1)height=1;offset+=levelSize}gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);return texture}}processor_1.PVRProcessor={onLoadStart:function(host,resource){return __awaiter(this,void 0,void 0,function(){var arraybuffer,width,height,borderWidth,borderHeight,byteArray,list,pvrDataBuffer,i,buffer,dataLength,self,texture;return __generator(this,function(_a){switch(_a.label){case 0:return[4,host.load(resource,processor_1.BinaryProcessor)];case 1:arraybuffer=_a.sent();width=512;height=512;borderWidth=0;borderHeight=0;byteArray=new egret.ByteArray(arraybuffer);byteArray.position=7;list=["body","ext"];for(i=0;i<list.length;i++){buffer=void 0;switch(list[i]){case"body":byteArray.position+=2;dataLength=byteArray.readUnsignedInt();pvrDataBuffer=byteArray.buffer.slice(byteArray.position,byteArray.position+dataLength);byteArray.position+=dataLength;break;case"ext":byteArray.position+=6;width=byteArray.readUnsignedShort();height=byteArray.readUnsignedShort();borderWidth=byteArray.readUnsignedShort();borderHeight=byteArray.readUnsignedShort();break}}self=this;PVRParser.parse(pvrDataBuffer,function(pvrData){var bitmapData=new egret.BitmapData(pvrData);bitmapData.format="pvr";texture=new egret.Texture;texture._setBitmapData(bitmapData);texture.$initData(borderWidth,borderHeight,width,height,0,0,width,height,bitmapData.width,bitmapData.height)},function(){console.log("pvr error")});return[2,texture]}})})},onRemoveStart:function(host,resource){return Promise.resolve()}};processor_1.ZipProcessor={onLoadStart:function(host,resource){console.warn(resource.url);return Promise.reject(resource.url)},onRemoveStart:function(){return Promise.resolve()},getData:function(host,resource,subkey){}};var _map={image:processor_1.ImageProcessor,json:processor_1.JsonProcessor,text:processor_1.TextProcessor,xml:processor_1.XMLProcessor,sheet:processor_1.SheetProcessor,font:processor_1.FontProcessor,bin:processor_1.BinaryProcessor,commonjs:processor_1.CommonJSProcessor,sound:processor_1.SoundProcessor,movieclip:processor_1.MovieClipProcessor,pvr:processor_1.PVRProcessor,mergeJson:processor_1.MergeJSONProcessor,resourceConfig:processor_1.ResourceConfigProcessor}})(processor=RES.processor||(RES.processor={}))})(RES||(RES={}));var RES;(function(RES){var ResourceEvent=function(_super){__extends(ResourceEvent,_super);function ResourceEvent(type,bubbles,cancelable){if(bubbles===void 0){bubbles=false}if(cancelable===void 0){cancelable=false}var _this=_super.call(this,type,bubbles,cancelable)||this;_this.itemsLoaded=0;_this.itemsTotal=0;_this.groupName="";return _this}ResourceEvent.dispatchResourceEvent=function(target,type,groupName,resItem,itemsLoaded,itemsTotal){if(groupName===void 0){groupName=""}if(resItem===void 0){resItem=undefined}if(itemsLoaded===void 0){itemsLoaded=0}if(itemsTotal===void 0){itemsTotal=0}var event=egret.Event.create(ResourceEvent,type);event.groupName=groupName;if(resItem){event.resItem=RES.ResourceItem.convertToResItem(resItem)}event.itemsLoaded=itemsLoaded;event.itemsTotal=itemsTotal;var result=target.dispatchEvent(event);egret.Event.release(event);return result};return ResourceEvent}(egret.Event);ResourceEvent.ITEM_LOAD_ERROR="itemLoadError";ResourceEvent.CONFIG_COMPLETE="configComplete";ResourceEvent.CONFIG_LOAD_ERROR="configLoadError";ResourceEvent.GROUP_PROGRESS="groupProgress";ResourceEvent.GROUP_COMPLETE="groupComplete";ResourceEvent.GROUP_LOAD_ERROR="groupLoadError";RES.ResourceEvent=ResourceEvent})(RES||(RES={}));var RES;(function(RES){var ResourceItem;(function(ResourceItem){ResourceItem.TYPE_XML="xml";ResourceItem.TYPE_IMAGE="image";ResourceItem.TYPE_BIN="bin";ResourceItem.TYPE_TEXT="text";ResourceItem.TYPE_JSON="json";ResourceItem.TYPE_SHEET="sheet";ResourceItem.TYPE_FONT="font";ResourceItem.TYPE_SOUND="sound";function convertToResItem(r){var name="";if(!RES.config.config){name=r.url}else{for(var aliasName in RES.config.config.alias){if(RES.config.config.alias[aliasName]==r.url){name=aliasName}}}var result={name:name,url:r.url,type:r.type,data:r};return result}ResourceItem.convertToResItem=convertToResItem})(ResourceItem=RES.ResourceItem||(RES.ResourceItem={}))})(RES||(RES={}));var RES;(function(RES){RES.checkNull=function(target,propertyKey,descriptor){var method=descriptor.value;descriptor.value=function(){var arg=[];for(var _i=0;_i<arguments.length;_i++){arg[_i]=arguments[_i]}if(!arg[0]){console.warn("方法"+propertyKey+"的参数不能为null");return null}else{return method.apply(this,arg)}}};RES.FEATURE_FLAG={LOADING_STATE:0};var upgrade;(function(upgrade){var _level="warning";function setUpgradeGuideLevel(level){_level=level}upgrade.setUpgradeGuideLevel=setUpgradeGuideLevel})(upgrade=RES.upgrade||(RES.upgrade={}))})(RES||(RES={}));var RES;(function(RES){var versionInfo;function native_init(){if(egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE){versionInfo=getLocalData("all.manifest")}}RES.native_init=native_init;function getRealURL(url){if(versionInfo&&versionInfo[url]){return"resource/"+versionInfo[url].v.substring(0,2)+"/"+versionInfo[url].v+"_"+versionInfo[url].s+"."+url.substring(url.lastIndexOf(".")+1)}else{return url}}RES.getRealURL=getRealURL;function getLocalData(filePath){if(egret_native.readUpdateFileSync&&egret_native.readResourceFileSync){var content=egret_native.readUpdateFileSync(filePath);if(content!=null){return JSON.parse(content)}content=egret_native.readResourceFileSync(filePath);if(content!=null){return JSON.parse(content)}}return null}})(RES||(RES={}));var RES;(function(RES){function registerAnalyzer(type,analyzerClass){throw new RES.ResourceManagerError(2002)}RES.registerAnalyzer=registerAnalyzer;function loadConfig(url,resourceRoot){instance=new Resource;return instance.loadConfig()}RES.loadConfig=loadConfig;function loadGroup(name,priority,reporter){if(priority===void 0){priority=0}return instance.loadGroup(name,priority,reporter)}RES.loadGroup=loadGroup;function isGroupLoaded(name){return instance.isGroupLoaded(name)}RES.isGroupLoaded=isGroupLoaded;function getGroupByName(name){return instance.getGroupByName(name).map(function(r){return RES.ResourceItem.convertToResItem(r)})}RES.getGroupByName=getGroupByName;function createGroup(name,keys,override){if(override===void 0){override=false}return instance.createGroup(name,keys,override)}RES.createGroup=createGroup;function hasRes(key){return instance.hasRes(key)}RES.hasRes=hasRes;function getRes(key){return instance.getRes(key)}RES.getRes=getRes;function getResAsync(key,compFunc,thisObject){return instance.getResAsync.apply(instance,arguments)}RES.getResAsync=getResAsync;function getResByUrl(url,compFunc,thisObject,type){if(type===void 0){type=""}instance.getResByUrl(url,compFunc,thisObject,type)}RES.getResByUrl=getResByUrl;function destroyRes(name,force){return instance.destroyRes(name,force)}RES.destroyRes=destroyRes;function setMaxLoadingThread(thread){instance.setMaxLoadingThread(thread)}RES.setMaxLoadingThread=setMaxLoadingThread;function setMaxRetryTimes(retry){instance.setMaxRetryTimes(retry)}RES.setMaxRetryTimes=setMaxRetryTimes;function addEventListener(type,listener,thisObject,useCapture,priority){if(useCapture===void 0){useCapture=false}if(priority===void 0){priority=0}instance.addEventListener(type,listener,thisObject,useCapture,priority)}RES.addEventListener=addEventListener;function removeEventListener(type,listener,thisObject,useCapture){if(useCapture===void 0){useCapture=false}instance.removeEventListener(type,listener,thisObject,useCapture)}RES.removeEventListener=removeEventListener;function $addResourceData(data){instance.addResourceData(data)}RES.$addResourceData=$addResourceData;var Resource=function(_super){__extends(Resource,_super);function Resource(){return _super!==null&&_super.apply(this,arguments)||this}Resource.prototype.loadConfig=function(){var _this=this;RES.native_init();return RES.config.init().then(function(data){RES.ResourceEvent.dispatchResourceEvent(_this,RES.ResourceEvent.CONFIG_COMPLETE)},function(error){RES.ResourceEvent.dispatchResourceEvent(_this,RES.ResourceEvent.CONFIG_LOAD_ERROR);return Promise.reject(error)})};Resource.prototype.isGroupLoaded=function(name){var resources=RES.config.getGroupByName(name,true);return resources.every(function(r){return RES.host.get(r)!=null})};Resource.prototype.getGroupByName=function(name){return RES.config.getGroupByName(name,true)};Resource.prototype.loadGroup=function(name,priority,reporter){var _this=this;if(priority===void 0){priority=0}var reporterDelegate={onProgress:function(current,total){if(reporter&&reporter.onProgress){reporter.onProgress(current,total)}RES.ResourceEvent.dispatchResourceEvent(_this,RES.ResourceEvent.GROUP_PROGRESS,name,undefined,current,total)}};return this._loadGroup(name,priority,reporterDelegate).then(function(data){RES.ResourceEvent.dispatchResourceEvent(_this,RES.ResourceEvent.GROUP_COMPLETE,name)},function(error){RES.ResourceEvent.dispatchResourceEvent(_this,RES.ResourceEvent.GROUP_LOAD_ERROR,name);return Promise.reject(error)})};Resource.prototype._loadGroup=function(name,priority,reporter){if(priority===void 0){priority=0}var resources=RES.config.getGroupByName(name,true);return RES.queue.load(resources,reporter)};Resource.prototype.loadResources=function(keys,reporter){var resources=keys.map(function(key){var r=RES.config.getResourceWithSubkey(key,true);return r.r});return RES.queue.load(resources,reporter)};Resource.prototype.createGroup=function(name,keys,override){if(override===void 0){override=false}return RES.config.createGroup(name,keys,override)};Resource.prototype.hasRes=function(key){return RES.config.getResourceWithSubkey(key)!=null};Resource.prototype.getRes=function(resKey){var result=RES.config.getResourceWithSubkey(resKey);if(result){var r=result.r;var key=result.key;var subkey=result.subkey;var p=RES.processor.isSupport(r);if(p&&p.getData&&subkey){return p.getData(RES.host,r,key,subkey)}else{return RES.host.get(r)}}else{return null}};Resource.prototype.getResAsync=function(key,compFunc,thisObject){var paramKey=key;var _a=RES.config.getResourceWithSubkey(key,true),r=_a.r,subkey=_a.subkey;return RES.queue.loadResource(r).then(function(value){RES.host.save(r,value);var p=RES.processor.isSupport(r);if(p&&p.getData&&subkey){value=p.getData(RES.host,r,key,subkey)}if(compFunc){compFunc.call(thisObject,value,paramKey)}return value})};Resource.prototype.getResByUrl=function(url,compFunc,thisObject,type){if(type===void 0){type=""}var r=RES.config.getResource(url);if(!r){if(!type){type=RES.config.__temp__get__type__via__url(url)}r={name:url,url:url,type:type,extra:true};RES.config.addResourceData(r);r=RES.config.getResource(url);if(r){r.extra=true}else{throw"never"}}return RES.queue.loadResource(r).then(function(value){if(compFunc&&r){compFunc.call(thisObject,value,r.url)}return value})};Resource.prototype.destroyRes=function(name,force){if(force===void 0){force=true}return __awaiter(this,void 0,void 0,function(){var group,remove,_i,group_2,item,item;return __generator(this,function(_a){switch(_a.label){case 0:group=RES.config.getGroup(name);remove=function(r){return RES.queue.unloadResource(r)};if(!(group&&group.length>0))return[3,5];_i=0,group_2=group;_a.label=1;case 1:if(!(_i<group_2.length))return[3,4];item=group_2[_i];return[4,remove(item)];case 2:_a.sent();_a.label=3;case 3:_i++;return[3,1];case 4:return[2,true];case 5:item=RES.config.getResource(name);if(!item)return[3,7];return[4,remove(item)];case 6:_a.sent();return[2,true];case 7:console.warn("无法删除指定组:"+name);return[2,false]}})})};Resource.prototype.setMaxLoadingThread=function(thread){if(thread<1){thread=1}};Resource.prototype.setMaxRetryTimes=function(retry){retry=Math.max(retry,0)};Resource.prototype.addResourceData=function(data){RES.config.addResourceData(data)};return Resource}(egret.EventDispatcher);__decorate([RES.checkCancelation],Resource.prototype,"loadConfig",null);__decorate([RES.checkCancelation],Resource.prototype,"_loadGroup",null);__decorate([RES.checkNull],Resource.prototype,"hasRes",null);__decorate([RES.checkNull],Resource.prototype,"getRes",null);__decorate([RES.checkNull,RES.checkCancelation],Resource.prototype,"getResAsync",null);__decorate([RES.checkNull,RES.checkCancelation],Resource.prototype,"getResByUrl",null);RES.Resource=Resource;var instance})(RES||(RES={}));
