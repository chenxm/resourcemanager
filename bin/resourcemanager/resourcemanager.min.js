var __extends=this&&this.__extends||function(e,r){function t(){this.constructor=e}for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n]);e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)},__awaiter=this&&this.__awaiter||function(e,r,t,n){return new(t||(t=Promise))(function(o,a){function s(e){try{i(n.next(e))}catch(r){a(r)}}function u(e){try{i(n["throw"](e))}catch(r){a(r)}}function i(e){e.done?o(e.value):new t(function(r){r(e.value)}).then(s,u)}i((n=n.apply(e,r||[])).next())})},__generator=this&&this.__generator||function(e,r){function t(e){return function(r){return n([e,r])}}function n(t){if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,a&&(s=a[2&t[0]?"return":t[0]?"throw":"next"])&&!(s=s.call(a,t[1])).done)return s;switch(a=0,s&&(t=[0,s.value]),t[0]){case 0:case 1:s=t;break;case 4:return u.label++,{value:t[1],done:!1};case 5:u.label++,a=t[1],t=[0];continue;case 7:t=u.ops.pop(),u.trys.pop();continue;default:if(s=u.trys,!(s=s.length>0&&s[s.length-1])&&(6===t[0]||2===t[0])){u=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){u.label=t[1];break}if(6===t[0]&&u.label<s[1]){u.label=s[1],s=t;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(t);break}s[2]&&u.ops.pop(),u.trys.pop();continue}t=r.call(e,u)}catch(n){t=[6,n],a=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}var o,a,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return{next:t(0),"throw":t(1),"return":t(2)}},__decorate=this&&this.__decorate||function(e,r,t,n){var o,a=arguments.length,s=3>a?r:null===n?n=Object.getOwnPropertyDescriptor(r,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,r,t,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(s=(3>a?o(s):a>3?o(r,t,s):o(r,t))||s);return a>3&&s&&Object.defineProperty(r,t,s),s},RES;!function(e){function r(r){t={type:"commonjs",resourceRoot:e.resourceRoot,url:r,name:r}}e.resourceNameSelector=function(e){return e};var t;e.setConfigURL=r,e.resourceRoot="";var n=function(){function r(){}return r.prototype.init=function(){var r=this;return e.queue.loadResource(t).then(function(e){return r.parseConfig(e)})["catch"](function(r){return r.__resource_manager_error__||(console.error(r.stack),r=new e.ResourceManagerError(1002)),Promise.reject(r)})},r.prototype.getGroupByName=function(r,t){var n=this.config.groups[r],o=[];if(!n){if(t)throw new e.ResourceManagerError(2005,r);return null}for(var a=0,s=n;a<s.length;a++){var u=s[a],i=e.config.getResourceWithSubkey(u,!0),c=i.key,f=(i.subkey,e.config.getResource(c,!0));-1==o.indexOf(f)&&o.push(f)}return o},r.prototype.__temp__get__type__via__url=function(r){var t=this.config.alias[r];if(t||(t=r),e.resourceTypeSelector){var n=e.resourceTypeSelector(t);if(!n)throw new e.ResourceManagerError(2004,t);return n}return console.warn("RES.mapConfig 并未设置 typeSelector"),"unknown"},r.prototype.getResourceWithSubkey=function(r,t){r=this.getKeyByAlias(r);var n=r.indexOf("#"),o="";n>=0&&(o=r.substr(n+1),r=r.substr(0,n));var a=this.getResource(r);if(a)return{r:a,key:r,subkey:o};if(t){var s=o?r+"#"+o:r;throw new e.ResourceManagerError(2006,s)}return null},r.prototype.getKeyByAlias=function(e){return this.config.alias[e]?this.config.alias[e]:e},r.prototype.getResource=function(r,t){var n=this.config.alias[r];n||(n=r);var o=e.getResourceInfo(n),a=o;if(!a){if(t)throw new e.ResourceManagerError(2006,r);return null}return a},r.prototype.getGroup=function(e){return this.getGroupByName(e)},r.prototype.createGroup=function(e,r,t){if(void 0===t&&(t=!1),!t&&this.config.groups[e]||!r||0==r.length)return!1;for(var n=[],o=0,a=r;o<a.length;o++){var s=a[o];if(this.config.groups[s]){var u=this.config.groups[s];n=n.concat(u)}else n=n.concat(s)}return this.config.groups[e]=n,!0},r.prototype.parseConfig=function(r){e.resourceRoot=r.resourceRoot+"/",this.config=r,e.resourceTypeSelector=r.typeSelector,e.resourceMergerSelector=r.mergeSelector,e.FileSystem.data=r.resources},r.prototype.addSubkey=function(e,r){this.addAlias(e,r+"#"+e)},r.prototype.addAlias=function(e,r){this.config.alias[r]&&(r=this.config.alias[r]),this.config.alias[e]=r},r.prototype.getType=function(e){return this.getResource(e,!0).type},r.prototype.addResourceData=function(r){r.type||(r.type=this.__temp__get__type__via__url(r.url)),e.FileSystem.addFile(r.url,r.type),r.name&&(this.config.alias[r.name]=r.url)},r.prototype.destory=function(){e.systemPid++,this.config={groups:{},alias:{},resources:{},typeSelector:function(e){return e},resourceRoot:"resources",mergeSelector:null},e.FileSystem.data={}},r}();e.ResourceConfig=n}(RES||(RES={}));var RES;!function(e){var r=function(){function r(){}return r.prototype.load=function(r,t){var n=this,o=0,a=1,s=function(r){return n.loadResource(r).then(function(n){return e.host.save(r,n),o++,t&&t.onProgress&&t.onProgress(o,a),n})};return a=r.length,Promise.all(r.map(s))},r.prototype.loadResource=function(r,t){if(t||(t=e.processor.isSupport(r)),!t)throw new e.ResourceManagerError(2001,r.name,r.type);e.host.state[r.name]=1;var n=t.onLoadStart(e.host,r);return r.promise=n,n},r.prototype.unloadResource=function(r){var t=e.host.get(r);if(!t)return console.warn("尝试释放不存在的资源:",r.name),Promise.resolve();var n=e.processor.isSupport(r);return n?(e.host.state[r.name]=3,n.onRemoveStart(e.host,r).then(function(t){return e.host.remove(r),t})):Promise.resolve()},r}();e.ResourceLoader=r}(RES||(RES={}));var RES;!function(e){function r(r){var t=n.getFile(r);return t||(r=e.resourceNameSelector(r),t=n.getFile(r)),t}var t;!function(e){e[e.FILE=0]="FILE",e[e.DICTIONARY=1]="DICTIONARY"}(t||(t={})),e.getResourceInfo=r;var n;!function(e){function r(e,r){r||(r=""),e=o(e);var t=n(e),c=a(e);i(c)||u(c);var f=s(c);f[t]={url:e,type:r}}function t(e){var r=s(e);return r&&(r.name=e),r}function n(e){return e.substr(e.lastIndexOf("/")+1)}function o(e){return e.split("/").filter(function(e){return!!e}).join("/")}function a(e){return e.substr(0,e.lastIndexOf("/"))}function s(r){if(""==r)return e.data;r=o(r);for(var t=r.split("/"),n=e.data,a=0,s=t;a<s.length;a++){var u=s[a];if(!n)return n;n=n[u]}return n}function u(r){r=o(r);for(var t=r.split("/"),n=e.data,a=0,s=t;a<s.length;a++){var u=s[a];n[u]||(n[u]={}),n=n[u]}}function i(r){if(""==r)return!0;r=o(r);for(var t=r.split("/"),n=e.data,a=0,s=t;a<s.length;a++){var u=s[a];if(!n[u])return!1;n=n[u]}return!0}e.data={},e.addFile=r,e.getFile=t,e.mkdir=u,e.exists=i}(n=e.FileSystem||(e.FileSystem={}))}(RES||(RES={}));var RES;!function(e){function r(){console.log(e.FileSystem.data),console.log(t);var r=0;for(var n in t){var o=t[n];o instanceof egret.Texture&&(r+=o._bitmapWidth*o._bitmapHeight*4)}console.log("gpu size : "+(r/1024).toFixed(3)+"kb")}var t={};e.systemPid=0,e.checkCancelation=function(r,t,o){var a=o.value;o.value=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var o=e.systemPid,s=a.apply(this,r);return s.then(function(t){if(e.systemPid!=o)throw new n(1005,r[0]);return t})}},e.profile=r,e.host={state:{},get resourceConfig(){return e.config},load:function(r,t){return e.queue.loadResource(r,t)},unload:function(r){return e.queue.unloadResource(r)},save:function(r,n){e.host.state[r.name]=2,t[r.url]=n},get:function(e){return t[e.url]},remove:function(r){e.host.state[r.name]=0,delete t[r.url]}},e.config=new e.ResourceConfig,e.queue=new e.ResourceLoader;var n=function(e){function r(t,n,o){var a=e.call(this)||this;return a.__resource_manager_error__=!0,a.name=t.toString(),a.message=r.errorMessage[t].replace("{0}",n).replace("{1}",o),a}return __extends(r,e),r}(Error);n.errorMessage={1001:"文件加载失败:{0}",1002:"ResourceManager 初始化失败：配置文件加载失败",1005:"ResourceManager 已被销毁，文件加载失败:{0}",2001:"{0}解析失败,不支持指定解析类型:'{1}'，请编写自定义 Processor ，更多内容请参见 https://github.com/egret-labs/resourcemanager/blob/master/docs/README.md#processor",2002:"Analyzer 相关API 在 ResourceManager 中不再支持，请编写自定义 Processor ，更多内容请参见 https://github.com/egret-labs/resourcemanager/blob/master/docs/README.md#processor",2003:"{0}解析失败,错误原因:{1}",2004:"无法找到文件类型:{0}",2005:"资源配置文件中无法找到特定的资源组:{0}",2006:"资源配置文件中无法找到特定的资源:{0}"},e.ResourceManagerError=n}(RES||(RES={}));var RES;!function(e){var r;!function(r){function t(e){return c[e.type]}function n(e,r){c[e]=r}function o(r,t){return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(o){return[2,new Promise(function(o,a){var s=function(){var e=r.data?r.data:r.response;o(e)},u=function(){var r=new e.ResourceManagerError(1001,t.url);a(r)};r.addEventListener(egret.Event.COMPLETE,s,n),r.addEventListener(egret.IOErrorEvent.IO_ERROR,u,n)})]})})}function a(r){var t=r.extra?"":e.resourceRoot,n=t+r.url;return e.getRealURL?e.getRealURL(n):n}function s(e,r){e=e.split("\\").join("/");var t=e.match(/#.*|\?.*/),n="";t&&(n=t[0]);var o=e.lastIndexOf("/");return e=-1!=o?e.substring(0,o+1)+r:r,e+n}function u(e,r,t){switch(e){case i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG:case i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:return Math.floor((Math.max(r,8)*Math.max(t,8)*4+7)/8);case i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG:case i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:return Math.floor((Math.max(r,16)*Math.max(t,8)*2+7)/8);default:return 0}}r.isSupport=t,r.map=n,r.getRelativePath=s,r.ImageProcessor={onLoadStart:function(e,r){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(s){switch(s.label){case 0:return e=new egret.ImageLoader,e.load(a(r)),[4,o(e,r)];case 1:return t=s.sent(),n=new egret.Texture,n._setBitmapData(t),[2,n]}})})},onRemoveStart:function(e,r){var t=e.get(r);return t.dispose(),Promise.resolve()}},r.BinaryProcessor={onLoadStart:function(e,r){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return e=new egret.HttpRequest,e.responseType=egret.HttpResponseType.ARRAY_BUFFER,e.open(a(r),"get"),e.send(),[4,o(e,r)];case 1:return t=n.sent(),[2,t]}})})},onRemoveStart:function(e,r){return Promise.resolve()}},r.TextProcessor={onLoadStart:function(e,r){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return e=new egret.HttpRequest,e.responseType=egret.HttpResponseType.TEXT,e.open(a(r),"get"),e.send(),[4,o(e,r)];case 1:return t=n.sent(),[2,t]}})})},onRemoveStart:function(e,r){return Promise.resolve()}},r.JsonProcessor={onLoadStart:function(e,t){return __awaiter(this,void 0,void 0,function(){var n,o;return __generator(this,function(a){switch(a.label){case 0:return[4,e.load(t,r.TextProcessor)];case 1:return n=a.sent(),o=JSON.parse(n),[2,o]}})})},onRemoveStart:function(e,r){return Promise.resolve()}},r.XMLProcessor={onLoadStart:function(e,t){return __awaiter(this,void 0,void 0,function(){var n,o;return __generator(this,function(a){switch(a.label){case 0:return[4,e.load(t,r.TextProcessor)];case 1:return n=a.sent(),o=egret.XML.parse(n),[2,o]}})})},onRemoveStart:function(e,r){return Promise.resolve()}},r.CommonJSProcessor={onLoadStart:function(t,n){return __awaiter(this,void 0,void 0,function(){var o,a,s,u;return __generator(this,function(i){switch(i.label){case 0:return[4,t.load(n,r.TextProcessor)];case 1:o=i.sent(),a=new Function("require","exports",o),s=function(){},u={};try{a(s,u)}catch(c){throw new e.ResourceManagerError(2003,n.name,c.message)}return[2,u]}})})},onRemoveStart:function(e,r){return Promise.resolve()}},r.SheetProcessor={onLoadStart:function(t,n){return __awaiter(this,void 0,void 0,function(){var o,a,u,i,c,f,l,p,i;return __generator(this,function(g){switch(g.label){case 0:return[4,t.load(n,r.JsonProcessor)];case 1:if(o=g.sent(),a=s(n.name,o.file),u=t.resourceConfig.getResource(a),!u)throw new e.ResourceManagerError(1001,a);return[4,t.load(u)];case 2:i=g.sent(),c=o.frames,f=new egret.SpriteSheet(i);for(l in c)p=c[l],i=f.createTexture(l,p.x,p.y,p.w,p.h,p.offX,p.offY,p.sourceW,p.sourceH);return[2,f]}})})},getData:function(e,r,t,n){var o=e.get(r);return o?o.getTexture(n):(console.error("missing resource : "+t+"#"+n),null)},onRemoveStart:function(e,r){return Promise.resolve()}},r.FontProcessor={onLoadStart:function(e,t){return __awaiter(this,void 0,void 0,function(){var n,o,a,s,u,i,c;return __generator(this,function(f){switch(f.label){case 0:return n=function(e,r){var t="",n=r.split("\n"),o=n[2],a=o.indexOf('file="');-1!=a&&(o=o.substring(a+6),a=o.indexOf('"'),t=o.substring(0,a)),e=e.split("\\").join("/");var a=e.lastIndexOf("/");return e=-1!=a?e.substring(0,a+1)+t:t},[4,e.load(t,r.TextProcessor)];case 1:o=f.sent(),a="";try{s=JSON.parse(o),a=t.name.replace("fnt","png")}catch(l){s=o,a=t.name.replace("fnt","png")}return u=e.resourceConfig.getResource(a),u?[4,e.load(u)]:[3,3];case 2:return i=f.sent(),c=new egret.BitmapFont(i,s),[2,c];case 3:return[2,null]}})})},onRemoveStart:function(e,r){return Promise.resolve()}},r.SoundProcessor={onLoadStart:function(e,r){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=new egret.Sound,e.load(a(r)),[4,o(e,r)];case 1:return t.sent(),[2,e]}})})},onRemoveStart:function(e,r){return Promise.resolve()}},r.MovieClipProcessor={onLoadStart:function(t,n){return __awaiter(this,void 0,void 0,function(){var o,a,s,u,i,c;return __generator(this,function(f){switch(f.label){case 0:return[4,t.load(n,r.JsonProcessor)];case 1:if(o=f.sent(),a=n.name,s=a.substring(0,a.lastIndexOf("."))+".png",u=t.resourceConfig.getResource(s),!u)throw new e.ResourceManagerError(1001,s);return[4,t.load(u)];case 2:return i=f.sent(),c=new egret.MovieClipDataFactory(o,i),[2,c]}})})},onRemoveStart:function(e,r){return Promise.resolve()}},r.MergeJSONProcessor={onLoadStart:function(t,n){return __awaiter(this,void 0,void 0,function(){var o,a;return __generator(this,function(s){switch(s.label){case 0:return[4,t.load(n,r.JsonProcessor)];case 1:o=s.sent();for(a in o)e.config.addSubkey(a,n.name);return[2,o]}})})},getData:function(e,r,t,n){var o=e.get(r);return o?o[n]:(console.error("missing resource :"+r.name),null)},onRemoveStart:function(e,r){return Promise.resolve()}},r.ResourceConfigProcessor={onLoadStart:function(t,n){return __awaiter(this,void 0,void 0,function(){var o,a,s,u;return __generator(this,function(i){switch(i.label){case 0:return[4,t.load(n,r.JsonProcessor)];case 1:return o=i.sent(),a=o.resources,s=function(e,r,t){for(var n in e){var o=r?r+"/"+n:n,a=e[n];u(a)?("string"==typeof a?(a={url:a,name:o},e[n]=a):a.name=o,t(a)):s(a,o,t)}},u=function(e){return"string"==typeof e||null!=e.url},s(a,"",function(r){r.type||(r.type=e.resourceTypeSelector(r.url))}),[2,o]}})})},onRemoveStart:function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})}};var i=function(){function e(){}return e.parse=function(r,t,n){var o=13,a=new Uint32Array(r,0,o),s={buffer:r,header:a};55727696===a[0]?e._parseV3(s,t,n):559044176===a[11]?e._parseV2(s,t,n):n(s,"pvr parse error!")},e._parseV2=function(r,t,n){var o,a,s=r.header,u=s[0],i=s[1],c=s[2],f=s[3],l=s[4],o=(s[5],s[6]),p=(s[7],s[8],s[9],s[10]),g=(s[11],s[12]),v=255,d=24,R=25,_=l&v,h=p>0;_===R?(a=h?e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,o=4):_===d?(a=h?e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,o=2):(n(r,"pvr v2 parse error"),console.log("unknow format flags::"+_));var m=u;r.pvrtcData=new Uint8Array(r.buffer,m),r.bpp=o,r.format=a,r.width=c,r.height=i,r.surfacesCount=g,r.mipmapsCount=f+1,r.isCubemap=6===r.surfacesCount,t(r)},e._parseV3=function(r,t,n){var o,a,s=r.header,u=s[2];switch(u){case 0:o=2,a=e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;break;case 1:o=2,a=e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;break;case 2:o=4,a=e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;break;case 3:o=4,a=e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;break;default:n(r,"pvr v3 parse error"),console.log("unknow pixel format::"+u)}var i=52+s[12];r.pvrtcData=new Uint8Array(r.buffer,i),r.bpp=o,r.format=a,r.width=s[7],r.height=s[6],r.surfacesCount=s[10],r.mipmapsCount=s[11],r.isCubemap=6===r.surfacesCount,t(r)},e}();i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840,i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841,i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842,i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843,"undefined"!=typeof egret&&egret&&egret.web&&egret.web.WebGLRenderContext&&(egret.web.WebGLRenderContext.prototype.createTextureFromCompressedData=function(e,r,t,n,o){var a=this.context;this.pvrtcExt||(this.pvrtcExt=a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"));var s=a.createTexture();a.bindTexture(a.TEXTURE_2D,s);for(var i=0,c=0;n>c;++c){var f=u(o,r,t),l=new Uint8Array(e.buffer,e.byteOffset+i,f);a.compressedTexImage2D(a.TEXTURE_2D,c,o,r,t,0,l),r>>=1,1>r&&(r=1),t>>=1,1>t&&(t=1),i+=f}return a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),s}),r.PVRProcessor={onLoadStart:function(e,t){return __awaiter(this,void 0,void 0,function(){var n,o,a,s,u,c,f,l,p,g,v,d,R;return __generator(this,function(_){switch(_.label){case 0:return[4,e.load(t,r.BinaryProcessor)];case 1:for(n=_.sent(),o=512,a=512,s=0,u=0,c=new egret.ByteArray(n),c.position=7,f=["body","ext"],p=0;p<f.length;p++)switch(g=void 0,f[p]){case"body":c.position+=2,v=c.readUnsignedInt(),l=c.buffer.slice(c.position,c.position+v),c.position+=v;break;case"ext":c.position+=6,o=c.readUnsignedShort(),a=c.readUnsignedShort(),s=c.readUnsignedShort(),u=c.readUnsignedShort()}return d=this,i.parse(l,function(e){var r=new egret.BitmapData(e);r.format="pvr",R=new egret.Texture,R._setBitmapData(r),R.$initData(s,u,o,a,0,0,o,a,r.width,r.height)},function(){console.log("pvr error")}),[2,R]}})})},onRemoveStart:function(e,r){return Promise.resolve()}};var c={image:r.ImageProcessor,json:r.JsonProcessor,text:r.TextProcessor,xml:r.XMLProcessor,sheet:r.SheetProcessor,font:r.FontProcessor,bin:r.BinaryProcessor,commonjs:r.CommonJSProcessor,sound:r.SoundProcessor,movieclip:r.MovieClipProcessor,pvr:r.PVRProcessor,mergeJson:r.MergeJSONProcessor,resourceConfig:r.ResourceConfigProcessor}}(r=e.processor||(e.processor={}))}(RES||(RES={}));var RES;!function(e){var r=function(r){function t(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var o=r.call(this,e,t,n)||this;return o.itemsLoaded=0,o.itemsTotal=0,o.groupName="",o}return __extends(t,r),t.dispatchResourceEvent=function(r,n,o,a,s,u){void 0===o&&(o=""),void 0===a&&(a=void 0),void 0===s&&(s=0),void 0===u&&(u=0);var i=egret.Event.create(t,n);i.groupName=o,a&&(i.resItem=e.ResourceItem.convertToResItem(a)),i.itemsLoaded=s,i.itemsTotal=u;var c=r.dispatchEvent(i);return egret.Event.release(i),c},t}(egret.Event);r.ITEM_LOAD_ERROR="itemLoadError",r.CONFIG_COMPLETE="configComplete",r.CONFIG_LOAD_ERROR="configLoadError",r.GROUP_PROGRESS="groupProgress",r.GROUP_COMPLETE="groupComplete",r.GROUP_LOAD_ERROR="groupLoadError",e.ResourceEvent=r}(RES||(RES={}));var RES;!function(e){var r;!function(r){function t(r){var t="";if(e.config.config)for(var n in e.config.config.alias)e.config.config.alias[n]==r.url&&(t=n);else t=r.url;var o={name:t,url:r.url,type:r.type,data:r};return o}r.TYPE_XML="xml",r.TYPE_IMAGE="image",r.TYPE_BIN="bin",r.TYPE_TEXT="text",r.TYPE_JSON="json",r.TYPE_SHEET="sheet",r.TYPE_FONT="font",r.TYPE_SOUND="sound",r.convertToResItem=t}(r=e.ResourceItem||(e.ResourceItem={}))}(RES||(RES={}));var RES;!function(e){e.checkNull=function(e,r,t){var n=t.value;t.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e[0]?n.apply(this,e):(console.warn("方法"+r+"的参数不能为null"),null)}},e.FEATURE_FLAG={LOADING_STATE:0};var r;!function(e){function r(e){t=e}var t="warning";e.setUpgradeGuideLevel=r}(r=e.upgrade||(e.upgrade={}))}(RES||(RES={}));var RES;!function(e){function r(){egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE&&(o=n("all.manifest"))}function t(e){return o&&o[e]?"resource/"+o[e].v.substring(0,2)+"/"+o[e].v+"_"+o[e].s+"."+e.substring(e.lastIndexOf(".")+1):e}function n(e){if(egret_native.readUpdateFileSync&&egret_native.readResourceFileSync){var r=egret_native.readUpdateFileSync(e);if(null!=r)return JSON.parse(r);if(r=egret_native.readResourceFileSync(e),null!=r)return JSON.parse(r)}return null}var o;e.native_init=r,e.getRealURL=t}(RES||(RES={}));var RES;!function(e){function r(r,t){throw new e.ResourceManagerError(2002)}function t(e,r){return h=new _,h.loadConfig()}function n(e,r,t){return void 0===r&&(r=0),h.loadGroup(e,r,t)}function o(e){return h.isGroupLoaded(e)}function a(r){return h.getGroupByName(r).map(function(r){return e.ResourceItem.convertToResItem(r)})}function s(e,r,t){return void 0===t&&(t=!1),h.createGroup(e,r,t)}function u(e){return h.hasRes(e)}function i(e){return h.getRes(e)}function c(e,r,t){return h.getResAsync.apply(h,arguments)}function f(e,r,t,n){void 0===n&&(n=""),h.getResByUrl(e,r,t,n)}function l(e,r){return h.destroyRes(e,r)}function p(e){h.setMaxLoadingThread(e)}function g(e){h.setMaxRetryTimes(e)}function v(e,r,t,n,o){void 0===n&&(n=!1),void 0===o&&(o=0),h.addEventListener(e,r,t,n,o)}function d(e,r,t,n){void 0===n&&(n=!1),h.removeEventListener(e,r,t,n)}function R(e){h.addResourceData(e)}e.registerAnalyzer=r,e.loadConfig=t,e.loadGroup=n,e.isGroupLoaded=o,e.getGroupByName=a,e.createGroup=s,e.hasRes=u,e.getRes=i,e.getResAsync=c,e.getResByUrl=f,e.destroyRes=l,e.setMaxLoadingThread=p,e.setMaxRetryTimes=g,e.addEventListener=v,e.removeEventListener=d,e.$addResourceData=R;var _=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return __extends(t,r),t.prototype.loadConfig=function(){var r=this;return e.native_init(),e.config.init().then(function(t){e.ResourceEvent.dispatchResourceEvent(r,e.ResourceEvent.CONFIG_COMPLETE)},function(t){return e.ResourceEvent.dispatchResourceEvent(r,e.ResourceEvent.CONFIG_LOAD_ERROR),Promise.reject(t)})},t.prototype.isGroupLoaded=function(r){var t=e.config.getGroupByName(r,!0);return t.every(function(r){return null!=e.host.get(r)})},t.prototype.getGroupByName=function(r){return e.config.getGroupByName(r,!0)},t.prototype.loadGroup=function(r,t,n){var o=this;void 0===t&&(t=0);var a={onProgress:function(t,a){n&&n.onProgress&&n.onProgress(t,a),e.ResourceEvent.dispatchResourceEvent(o,e.ResourceEvent.GROUP_PROGRESS,r,void 0,t,a)}};return this._loadGroup(r,t,a).then(function(t){e.ResourceEvent.dispatchResourceEvent(o,e.ResourceEvent.GROUP_COMPLETE,r)},function(t){return e.ResourceEvent.dispatchResourceEvent(o,e.ResourceEvent.GROUP_LOAD_ERROR,r),Promise.reject(t)})},t.prototype._loadGroup=function(r,t,n){void 0===t&&(t=0);var o=e.config.getGroupByName(r,!0);return e.queue.load(o,n)},t.prototype.loadResources=function(r,t){var n=r.map(function(r){var t=e.config.getResourceWithSubkey(r,!0);return t.r});return e.queue.load(n,t)},t.prototype.createGroup=function(r,t,n){return void 0===n&&(n=!1),e.config.createGroup(r,t,n)},t.prototype.hasRes=function(r){return null!=e.config.getResourceWithSubkey(r)},t.prototype.getRes=function(r){var t=e.config.getResourceWithSubkey(r);if(t){var n=t.r,o=t.key,a=t.subkey,s=e.processor.isSupport(n);return s&&s.getData&&a?s.getData(e.host,n,o,a):e.host.get(n)}return null},t.prototype.getResAsync=function(r,t,n){var o=r,a=e.config.getResourceWithSubkey(r,!0),s=a.r,u=a.subkey;return e.queue.loadResource(s).then(function(a){e.host.save(s,a);var i=e.processor.isSupport(s);return i&&i.getData&&u&&(a=i.getData(e.host,s,r,u)),t&&t.call(n,a,o),a})},t.prototype.getResByUrl=function(r,t,n,o){void 0===o&&(o="");var a=e.config.getResource(r);if(!a){if(o||(o=e.config.__temp__get__type__via__url(r)),a={name:r,url:r,type:o,extra:!0},e.config.addResourceData(a),a=e.config.getResource(r),!a)throw"never";a.extra=!0}return e.queue.loadResource(a).then(function(e){return t&&a&&t.call(n,e,a.url),e})},t.prototype.destroyRes=function(r,t){return void 0===t&&(t=!0),__awaiter(this,void 0,void 0,function(){var t,n,o,a,s,s;return __generator(this,function(u){switch(u.label){case 0:if(t=e.config.getGroup(r),n=function(r){return e.queue.unloadResource(r)},!(t&&t.length>0))return[3,5];o=0,a=t,u.label=1;case 1:return o<a.length?(s=a[o],[4,n(s)]):[3,4];case 2:u.sent(),u.label=3;case 3:return o++,[3,1];case 4:return[2,!0];case 5:return s=e.config.getResource(r),s?[4,n(s)]:[3,7];case 6:return u.sent(),[2,!0];case 7:return console.warn("无法删除指定组:"+r),[2,!1]}})})},t.prototype.setMaxLoadingThread=function(e){1>e&&(e=1)},t.prototype.setMaxRetryTimes=function(e){e=Math.max(e,0)},t.prototype.addResourceData=function(r){e.config.addResourceData(r)},t}(egret.EventDispatcher);__decorate([e.checkCancelation],_.prototype,"loadConfig",null),__decorate([e.checkCancelation],_.prototype,"_loadGroup",null),__decorate([e.checkNull],_.prototype,"hasRes",null),__decorate([e.checkNull],_.prototype,"getRes",null),__decorate([e.checkNull,e.checkCancelation],_.prototype,"getResAsync",null),__decorate([e.checkNull,e.checkCancelation],_.prototype,"getResByUrl",null),e.Resource=_;var h}(RES||(RES={}));